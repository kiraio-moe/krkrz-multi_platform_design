# Android作業項目や制限等
## NEON対応
グラフィック関係のSSE2部分をNEON化する。  
ソフトウェア描画が必須ではないので後での対応で問題なし。  
[libsimdpp](https://github.com/p12tic/libsimdpp) などを利用して抽象化し、CPU依存を減らす方法も検討。  
使用可能命令などの理解がないと速度があまり出ないかもしれないが、PCで開発してそのまま持って行けるメリットはある。  
ある程度速くなれば良いと言うことであれば、実用的かもしれない。

## サウンド対応 OpenSL
吉里吉里と同程度の機能を有するのならOpenSLでの実装が必要になる。

## 動画対応
Javaを使ってOpenGLのテクスチャに描く。H.264ならこの方法。  
C++ならOpenMAXになるがMPEG2になる模様。  
独自エンジンとするとTheora。

## Window (Activity)
複数ウィンドウは対応できないので、単一ウィンドウで仮想的なWindowクラスを作る。

# 要求
* パーミッション確認ダイアログ(6.0以降からJavaで実装)  
以前はインストール時にパーミッション確認があったが、6.0以降からアプリが任意タイミングで出来るようになった。そのため自前で確認要求する必要がある。  
ゲームだと、ストレージ、ネットワーク、バイブレーション辺りか。
* onPause でのセーブ  
非アクティブ化時に onPause が来るが、その後バックグラウンドに回った後に何の通知もなく殺されるケースがあるので、非アクティブ化時の onPause でオートセーブがあったほうがよい。
非アクティブ化は、電話がかかってきた時など注意したら防げるものでもない。
* ファイル名大文字小文字の扱い  
Androidのファイルシステムはケースセンシティブなのでどうするか検討。開発時のみだと思うので、見付からない場合毎回検索してもいいかも。
* グローバル変数のクリア問題  
Androidでアプリ再起動された時グローバル変数がクリアされない(再利用される)問題がある。NativeActivityを使う場合はsoを分離して、起動時に本体を毎回読み込むことで毎回クリアを確実にする。普通のActivity使うならJavaから毎回soを読み込むので気にすることは少ない。
* プッシュ通知(必要なら)  
プッシュ通知は別途サーバーを準備する必要がある。配信には必ずしも必要ではないが、通知先のIDを登録するサーバーが必要。通知先IDはメールアドレスのようなもの。  
Googleのプッシュ通知がアダルトOKかは不明。Amazonのサービス等必要かも。
* DRM  
DRMはストアごとに異なるので、それぞれ準備する必要がある。Javaで実装する。  
Amazonに登録する場合は不要でストアが勝手にやってくれる。
* 文字入力  
ソフトウェアキーボードな上に直接入力は難しいのでダイアログでの入力になる
* RSS等による更新取得  
プッシュ通知が出来ない場合は、何らかのタイミングで定期的にRSSなどを読んで更新情報取得する。1日1回ロック解除時か、タイマーか。タイマーよりも何らかのイベントをトリガーとした方が確実。
* タッチ、回転操作  
Windows版もZから実装済みなので、同等のものをAndroidでも実装する。

# 実装しない、検討を要するもの
* マウス入力、ゲームパッド入力  
あった方がいいが、スマフォ・タブレット主体ならなくてもいい。将来実装項目。
* 動画は機能制限  
セグメントループやピリオドなど困難な可能性あり
* Shift-JIS 廃止、UTF-8 に一本化  
吉里吉里3から持ってきたSJISToUnicodeStringなどの変換関数を内部に持っているので、そちらに一本化すればShift-JIS対応は可能。  
どうしても必要と言うことでなければ、UTF-8 に一本化する方が後々楽になる。  
* wchar\_tのバイトサイズ問題  
Linux系ではwchar\_tは4バイトとなるので、2バイト前提となっている箇所では問題が発生しうる。  
文字列処理系の関数を自前で持ち、2バイト固定で処理すると安心ではあるが、少し手間がある。  
いくつかの関数は自前実装となっている。  
文字列処理系もSIMD化による恩恵があるので、その高速化も見越して自前化していくのもあり。  
Androidの標準ライブラリとしてBionic libcがBSDライセンスで公開されているので、そちらに手を加えてwchar\_tをtjs_char 2バイトとして書き換え使用する手もある。
* pathデリミタ  
Windowsでは\\だが、Linux系は/となるので、その差を吸収するようにうまく作るようにする。  
/を基本として、\\は内部以外では使わないのが望ましい。

# 機種依存問題等
[GLSL機種依存問題](http://dench.flatlib.jp/opengl/glsl)

# ツールなど
* Android用リリーサー  
アイコン、タイトル、パッケージ名、アーカイブ、署名のみを差し替えるツール。  
毎回ビルドせずにリリース可能にする。

# 開発環境
Javaでの開発も必要なためJava開発が行いやすいAndroid Studioが使いやすいが、C++に関してはまだまともに使えない。  
C++はVisual Studio(+nVIDIA AndroidWorks)が使えるといい。  
機能のON/OFFをデバッグオプション化して、コマンドラインでビルド出来ると効率的。  
モバイル環境では不要な機能をOFFにしてバイナリサイズを抑えたいなどの要望もありうる。  
プラグインも本体に組み込んでしまった方が取り回しやすい。  

# メモ
広告・インターステンシャルで任意タイミングで挟めると同人向けにはいいかも。  
バナー広告だと画面狭くなるし下だと邪魔だしタップされなさそう。  
インターステンシャルで挟めるとシーンの切り替わり時に挟むことで効果的に広告収入ありそう？